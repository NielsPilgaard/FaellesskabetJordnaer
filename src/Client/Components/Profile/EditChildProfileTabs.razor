<MudDynamicTabs  @bind-ActivePanelIndex="@_activePanelIndex"
                AddTab="@AddTabCallback"
                AddIconToolTip="Klik for at oprette et barn"
                PanelClass="px-4 py-6"
                Elevation="4"
                Rounded
                ApplyEffectsToContainer>
    @foreach (var childProfile in Parent.ChildProfiles)
    {
        <MudTabPanel ShowCloseIcon="false" ID="@childProfile.Id" Text="@childProfile.FirstName">
            <EditChildProfile Parent="Parent" ChildProfile="childProfile" />
        </MudTabPanel>
    }
</MudDynamicTabs>

@code
{
    [Parameter]
    public required UserProfile Parent { get; set; }

    [Parameter]
    public EventCallback<UserProfile> ParentChanged { get; set; }

  private int _activePanelIndex = 0;

    public async Task AddTab(Guid id)
    {
        Parent.ChildProfiles.Add(new ChildProfile { Id = id, Gender = Gender.PreferNotToSay, FirstName = "" });

      await ParentChanged.InvokeAsync(Parent);

        _activePanelIndex = Parent.ChildProfiles.Count - 1; // Automatically switch to the new tab.
    }

    async Task AddTabCallback() => await AddTab(Guid.NewGuid());
}
