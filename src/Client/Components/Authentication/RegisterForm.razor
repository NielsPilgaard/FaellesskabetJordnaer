@using Jordnaer.Client.Authentication
@using Microsoft.AspNetCore.Components
@inject ISnackbar Snackbar
@inject AuthStateProvider Client

<MudPaper Elevation="5" Class="pa-4">
    <EditForm Model="@_registrationModel" OnValidSubmit="Create">
        <DataAnnotationsValidator />
        <MudStack Spacing="2">
            <MudTextField Label="Fornavn"
                          @bind-Value="_registrationModel.Firstname"
                          For="@(() => _registrationModel.Firstname)"
                          name="name" />
            <MudTextField Label="Efternavn"
                          @bind-Value="_registrationModel.Lastname"
                          For="@(() => _registrationModel.Lastname)"
                          name="lastname" />
            <MudTextField Label="Email"
                          @bind-Value="_registrationModel.Email"
                          For="@(() => _registrationModel.Email)"
                          InputType="InputType.Email"
                          InputMode="InputMode.email"
                          name="reg_email__" />
            <MudTextField Label="Adresse"
                          @bind-Value="_registrationModel.Address"
                          For="@(() => _registrationModel.Address)"
                          name="address" />
            <MudTextField Label="Postnummer"
                          @bind-Value="_registrationModel.ZipCode"
                          For="@(() => _registrationModel.ZipCode)"
                          InputType="InputType.Number"
                          InputMode="InputMode.numeric"
                          name="zipcode" />
            <MudTextField Label="By"
                          @bind-Value="_registrationModel.City"
                          For="@(() => _registrationModel.City)"
                          name="city" />
            <MudTextField autocomplete="new-password"
                          Label="Kodeord"
                          @bind-Value="_registrationModel.Password"
                          For="@(() => _registrationModel.Password)"
                          InputType="InputType.Password" />
            <MudTextField autocomplete="new-password"
                          Label="Gentag kodeord"
                          @bind-Value="_registrationModel.RepeatPassword"
                          For="@(() => _registrationModel.RepeatPassword)"
                          InputType="InputType.Password" />
            <MudButton ButtonType="ButtonType.Submit" Variant="Variant.Filled" Color="Color.Primary">Opret Konto</MudButton>
        </MudStack>
    </EditForm>
</MudPaper>

@code {
    private RegistrationModel _registrationModel = new();

    async Task Create()
    {
        var registrationCompleted = await Client.CreateUserAsync(_registrationModel.Email, _registrationModel.Password);
        if (registrationCompleted is false)
        {
            Snackbar.Add(ErrorMessages.RegistrationFailed, Severity.Warning, options =>
          {
              options.CloseAfterNavigation = true;
              options.VisibleStateDuration = 5000;
              options.ShowTransitionDuration = 1000;
          });
        }
    }

}
