@using Jordnaer.Client.Authentication

@inject AuthStateProvider Client
@inject NavigationManager NavigationManager
@inject ISnackbar Snackbar

<EditForm Model="@_loginModel" OnValidSubmit="Login">
    <DataAnnotationsValidator />
    <MudStack Spacing="2">
        <MudTextField Label="Email"
                      @bind-Value="_loginModel.Email"
                      For="@(() => _loginModel.Email)"
                      InputType="InputType.Email"
                      InputMode="InputMode.email" />
        <MudTextField Label="Kodeord"
                      @bind-Value="_loginModel.Password"
                      For="@(() => _loginModel.Password)"
                      InputType="InputType.Password" />
        <MudButton Size="Size.Large"
                   StartIcon="@Icons.Material.Filled.Login"
                   Class="mt-3"
                   ButtonType="ButtonType.Submit"
                   Variant="Variant.Filled"
                   Color="Color.Primary">
            Log ind
        </MudButton>
    </MudStack>
</EditForm>

@code {
    private LoginModel _loginModel = new();

    async Task Login()
    {
        if (await Client.LoginAsync(_loginModel.Email, _loginModel.Password))
        {
            NavigationManager.NavigateTo("");
            return;
        }

        Snackbar.Add(ErrorMessages.LOGIN_FAILED, Severity.Warning, options =>
        {
            options.CloseAfterNavigation = true;
            options.VisibleStateDuration = 5000;
            options.ShowTransitionDuration = 250;
        });
    }
}
