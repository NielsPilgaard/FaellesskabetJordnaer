@page "/groups/{GroupName}"
@using Jordnaer.Features.Groups

@inject IGroupClient GroupClient
@inject ISnackbar Snackbar
@inject IJSRuntime JsRuntime

<MudLoading @bind-Loading="_isLoading" Darken Overlap>

    @if (_group is null && _isLoading is false)
    {
        <NotFoundComponent Message="Vi fandt ingen gruppe med det navn, beklager!"/>
        return;
    }
    @if (_group is null)
    {
        return;
    }

    <MetadataComponent Title="@_group.Name"
                       Description="@($"Beskrivelse af {_group.Name}:\n {_group.ShortDescription}")"
                       Image="@_group.ProfilePictureUrl" />

    <MudFab StartIcon="@Icons.Material.Filled.ArrowBack" Class="mb-5" Color="Color.Primary" OnClick="JsRuntime.GoBackAsync" />

    @*// TODO: Request to join button*@

    <MudGrid>
        <MudItem xs="12">
            @*  TODO: Display group nicely          <UserProfileCard Profile="_profile" UserName="@UserName" />*@
        </MudItem>

        @if (_group.Categories.Length > 0)
        {
            <MudDivider Class="my-5" />
            <MudItem xs="12">
                <MudText Typo="Typo.h5"><MudIcon Class="mr-2" Icon="@Icons.Material.Filled.Star" />Kategorier</MudText>
            </MudItem>
            <MudItem xs="12" Class="d-flex justify-start">
                <MudChipSet ReadOnly>
                @foreach (var category in _group.Categories)
                    {
                        <MudChip Color="Color.Tertiary">@category</MudChip>
                    }
                </MudChipSet>
            </MudItem>
        }
    </MudGrid>
</MudLoading>

@code {
    [Parameter]
    public string? GroupName { get; set; }

    private GroupSlim? _group;

    private bool _isLoading = true;

    protected override async Task OnInitializedAsync()
    {
        if (GroupName is not null)
        {
            var response = await GroupClient.GetSlimGroupByNameAsync(GroupName);
            switch (response.StatusCode)
            {
                case var _ when response is { IsSuccessStatusCode: true, Content: not null }:
                    _group = response.Content;
                    break;

                case HttpStatusCode.NotFound:
                    break;

                case HttpStatusCode.TooManyRequests:
                    Snackbar.Add(ErrorMessages.High_Load, Severity.Info);
                    break;

                default:
                    Snackbar.Add(ErrorMessages.Something_Went_Wrong_Refresh, Severity.Warning);
                    break;
            }
        }

        _isLoading = false;
    }
}
